#ifndef PLATFORM_H
#define PLATFORM_H

#define GPIO_TO_PIN(bank, gpioPin) (32 * (bank) + (gpioPin)) 
#define CS_ON	0
#define CS_OFF	0xB //0XB
#define ADV_ON	0 //0
#define ADV_OFF	2 //2
#define WR_CYC	0xB //0X7
#define WR_ON	5
#define WR_OFF  0xF //((CS_ON + CS_OFF)-WR_ON)
#define RD_CYC	0xB   //7
#define OE_ON	5 //5
#define OE_OFF  0xF  //((CS_ON + CS_OFF)-OE_ON) A
#define RD_ACC_TIME 0xA   //A
#define WRDATAONADMUX 4  //number of cycle before taking control of data bus (when add/data multiplexing)

extern void __iomem *gpmc_base;
//       <--7-->
//CS1	\_______/
//	<-2>_____
//ADV	\__/
//	____ <-4->
//WR	     \___/
//	____ <-4->
//WR	     \___/

#define GPMC_CHUNK_SHIFT	24		/* 16 MB */
#define GPMC_SECTION_SHIFT	28		/* 128 MB */

#define GPMC_CS_CONFIG1		0x00
#define GPMC_CS_CONFIG2		0x04
#define GPMC_CS_CONFIG3		0x08
#define GPMC_CS_CONFIG4		0x0c
#define GPMC_CS_CONFIG5		0x10
#define GPMC_CS_CONFIG6		0x14
#define GPMC_CS_CONFIG7		0x18
#define GPMC_CS0_OFFSET		0x60
#define GPMC_CS_SIZE		0x30
#define GPMC_CONFIG1(n)   GPMC_OFFSET(GPMC_CS0_OFFSET + GPMC_CS_CONFIG1, n, GPMC_CS_SIZE)
#define GPMC_CONFIG2(n)   GPMC_OFFSET(GPMC_CS0_OFFSET + GPMC_CS_CONFIG2, n, GPMC_CS_SIZE)
#define GPMC_CONFIG3(n)   GPMC_OFFSET(GPMC_CS0_OFFSET + GPMC_CS_CONFIG3, n, GPMC_CS_SIZE)
#define GPMC_CONFIG4(n)   GPMC_OFFSET(GPMC_CS0_OFFSET + GPMC_CS_CONFIG4, n, GPMC_CS_SIZE)
#define GPMC_CONFIG5(n)   GPMC_OFFSET(GPMC_CS0_OFFSET + GPMC_CS_CONFIG5, n, GPMC_CS_SIZE)
#define GPMC_CONFIG6(n)   GPMC_OFFSET(GPMC_CS0_OFFSET + GPMC_CS_CONFIG6, n, GPMC_CS_SIZE)
#define GPMC_CONFIG7(n)   GPMC_OFFSET(GPMC_CS0_OFFSET + GPMC_CS_CONFIG7, n, GPMC_CS_SIZE)
#define GPMC_REVISION       (0x0)
#define GPMC_SYSCONFIG      (0x10)
#define GPMC_SYSSTATUS      (0x14)
#define GPMC_IRQSTATUS      (0x18)
#define GPMC_IRQENABLE      (0x1C)
#define GPMC_TIMEOUT_CONTROL   (0x40)
#define GPMC_ERR_ADDRESS   (0x44)
#define GPMC_ERR_TYPE   (0x48)
#define GPMC_CONFIG   (0x50)
#define GPMC_STATUS   (0x54)
#define GPMC_CONFIG7_CSVALID (1 << 6)

#define GPMC_CONFIG7_BASEADDRESS_MASK	0x3f
#define GPMC_CONFIG7_CSVALID_MASK	BIT(6)
#define GPMC_CONFIG7_MASKADDRESS_OFFSET	8
#define GPMC_CONFIG7_MASKADDRESS_MASK	(0xf << GPMC_CONFIG7_MASKADDRESS_OFFSET)
#define GPMC_CONFIG7_MASK	(GPMC_CONFIG7_BASEADDRESS_MASK | \
					 GPMC_CONFIG7_CSVALID_MASK |     \
					 GPMC_CONFIG7_MASKADDRESS_MASK)

#define GPMC_MEM_END 0x3FFFFFFF

/* REVISION */
#define GPMC_REVISION_REVISION   (0x000000FFu)
#define GPMC_REVISION_REVISION_SHIFT   (0x00000000u)


/* SYSCONFIG */
#define GPMC_SYSCONFIG_AUTOIDLE   (0x00000001u)
#define GPMC_SYSCONFIG_AUTOIDLE_SHIFT   (0x00000000u)
#define GPMC_SYSCONFIG_AUTOIDLE_AUTORUN   (0x1u)
#define GPMC_SYSCONFIG_AUTOIDLE_FREERUN   (0x0u)

#define GPMC_SYSCONFIG_IDLEMODE   (0x00000018u)
#define GPMC_SYSCONFIG_IDLEMODE_SHIFT   (0x00000003u)
#define GPMC_SYSCONFIG_IDLEMODE_FORCEIDLE   (0x0u)
#define GPMC_SYSCONFIG_IDLEMODE_NOIDLE   (0x1u)
#define GPMC_SYSCONFIG_IDLEMODE_RESERVED   (0x3u)
#define GPMC_SYSCONFIG_IDLEMODE_SMARTIDLE   (0x2u)

#define GPMC_SYSCONFIG_SOFTRESET   (0x00000002u)
#define GPMC_SYSCONFIG_SOFTRESET_SHIFT   (0x00000001u)
#define GPMC_SYSCONFIG_SOFTRESET_NORMAL   (0x0u)
#define GPMC_SYSCONFIG_SOFTRESET_RESET   (0x1u)

/* SYSSTATUS */
#define GPMC_SYSSTATUS_RESETDONE   (0x00000001u)
#define GPMC_SYSSTATUS_RESETDONE_SHIFT   (0x00000000u)
#define GPMC_SYSSTATUS_RESETDONE_RSTDONE   (0x1u)
#define GPMC_SYSSTATUS_RESETDONE_RSTONGOING   (0x0u)

/* CONFIG1_0 */
#define GPMC_CONFIG1_0_ATTACHEDDEVICEPAGELENGTH   (0x01800000u)
#define GPMC_CONFIG1_0_ATTACHEDDEVICEPAGELENGTH_SHIFT   (0x00000017u)
#define GPMC_CONFIG1_0_ATTACHEDDEVICEPAGELENGTH_EIGHT   (0x1u)
#define GPMC_CONFIG1_0_ATTACHEDDEVICEPAGELENGTH_FOUR    (0x2u) //(0x0u)
#define GPMC_CONFIG1_0_ATTACHEDDEVICEPAGELENGTH_RESERVED   (0x3u)
#define GPMC_CONFIG1_0_ATTACHEDDEVICEPAGELENGTH_SIXTEEN   (0x2u)

#define GPMC_CONFIG1_0_CLKACTIVATIONTIME   (0x06000000u)
#define GPMC_CONFIG1_0_CLKACTIVATIONTIME_SHIFT   (0x00000019u)
#define GPMC_CONFIG1_0_CLKACTIVATIONTIME_ATSTART   (0x0u)
#define GPMC_CONFIG1_0_CLKACTIVATIONTIME_NOTDEFINED   (0x3u)
#define GPMC_CONFIG1_0_CLKACTIVATIONTIME_ONECLKB4   (0x1u)
#define GPMC_CONFIG1_0_CLKACTIVATIONTIME_TWOCLKB4   (0x2u)

#define GPMC_CONFIG1_0_DEVICESIZE   (0x00003000u)
#define GPMC_CONFIG1_0_DEVICESIZE_SHIFT   (0x0000000Cu)
#define GPMC_CONFIG1_0_DEVICESIZE_EIGHTBITS   (0x0u)
#define GPMC_CONFIG1_0_DEVICESIZE_RES   (0x3u)
#define GPMC_CONFIG1_0_DEVICESIZE_RESERVED   (0x2u)
#define GPMC_CONFIG1_0_DEVICESIZE_SIXTEENBITS   (0x1u)

#define GPMC_CONFIG1_0_DEVICETYPE   (0x00000C00u)
#define GPMC_CONFIG1_0_DEVICETYPE_SHIFT   (0x0000000Au)
#define GPMC_CONFIG1_0_DEVICETYPE_NANDLIKE   (0x2u)
#define GPMC_CONFIG1_0_DEVICETYPE_NORLIKE   (0x0u)
#define GPMC_CONFIG1_0_DEVICETYPE_RES1   (0x1u)
#define GPMC_CONFIG1_0_DEVICETYPE_RES2   (0x3u)

#define GPMC_CONFIG1_0_GPMCFCLKDIVIDER   (0x00000003u)
#define GPMC_CONFIG1_0_GPMCFCLKDIVIDER_SHIFT   (0x00000000u)
#define GPMC_CONFIG1_0_GPMCFCLKDIVIDER_DIVBY1   (0x0u)
#define GPMC_CONFIG1_0_GPMCFCLKDIVIDER_DIVBY2   (0x1u)
#define GPMC_CONFIG1_0_GPMCFCLKDIVIDER_DIVBY3   (0x2u)
#define GPMC_CONFIG1_0_GPMCFCLKDIVIDER_DIVBY4   (0x3u)

#define GPMC_CONFIG1_0_MUXADDDATA   (0x00000300u)
#define GPMC_CONFIG1_0_MUXADDDATA_SHIFT   (0x00000008u)
#define GPMC_CONFIG1_0_MUXADDDATA_AADMUX   (0x1u)
#define GPMC_CONFIG1_0_MUXADDDATA_MUX   (0x2u)
#define GPMC_CONFIG1_0_MUXADDDATA_NONMUX   (0x0u)
#define GPMC_CONFIG1_0_MUXADDDATA_RESERVED   (0x3u)

#define GPMC_CONFIG1_0_READMULTIPLE   (0x40000000u)
#define GPMC_CONFIG1_0_READMULTIPLE_SHIFT   (0x0000001Eu)
#define GPMC_CONFIG1_0_READMULTIPLE_RDMULTIPLE   (0x1u)
#define GPMC_CONFIG1_0_READMULTIPLE_RDSINGLE   (0x0u)

#define GPMC_CONFIG1_0_READTYPE   (0x20000000u)
#define GPMC_CONFIG1_0_READTYPE_SHIFT   (0x0000001Du)
#define GPMC_CONFIG1_0_READTYPE_RDASYNC   (0x0u)
#define GPMC_CONFIG1_0_READTYPE_RDSYNC   (0x1u)

#define GPMC_CONFIG1_0_TIMEPARAGRANULARITY   (0x00000010u)
#define GPMC_CONFIG1_0_TIMEPARAGRANULARITY_SHIFT   (0x00000004u)
#define GPMC_CONFIG1_0_TIMEPARAGRANULARITY_X1   (0x0u)
#define GPMC_CONFIG1_0_TIMEPARAGRANULARITY_X2   (0x1u)

#define GPMC_CONFIG1_0_WAITMONITORINGTIME   (0x000C0000u)
#define GPMC_CONFIG1_0_WAITMONITORINGTIME_SHIFT   (0x00000012u)
#define GPMC_CONFIG1_0_WAITMONITORINGTIME_ATVALID   (0x0u)
#define GPMC_CONFIG1_0_WAITMONITORINGTIME_NOTDEFINED   (0x3u)
#define GPMC_CONFIG1_0_WAITMONITORINGTIME_ONEDEVICEB4   (0x1u)
#define GPMC_CONFIG1_0_WAITMONITORINGTIME_TWODEVICEB4   (0x2u)

#define GPMC_CONFIG1_0_WAITPINSELECT   (0x00030000u)
#define GPMC_CONFIG1_0_WAITPINSELECT_SHIFT   (0x00000010u)
#define GPMC_CONFIG1_0_WAITPINSELECT_RESERVED   (0x3u)
#define GPMC_CONFIG1_0_WAITPINSELECT_W0   (0x0u)
#define GPMC_CONFIG1_0_WAITPINSELECT_W1   (0x1u)
#define GPMC_CONFIG1_0_WAITPINSELECT_W2   (0x2u)

#define GPMC_CONFIG1_0_WAITREADMONITORING   (0x00400000u)
#define GPMC_CONFIG1_0_WAITREADMONITORING_SHIFT   (0x00000016u)
#define GPMC_CONFIG1_0_WAITREADMONITORING_WMONIT   (0x1u)
#define GPMC_CONFIG1_0_WAITREADMONITORING_WNOTMONIT   (0x0u)

#define GPMC_CONFIG1_0_WAITWRITEMONITORING   (0x00200000u)
#define GPMC_CONFIG1_0_WAITWRITEMONITORING_SHIFT   (0x00000015u)
#define GPMC_CONFIG1_0_WAITWRITEMONITORING_WMONIT   (0x1u)
#define GPMC_CONFIG1_0_WAITWRITEMONITORING_WNOTMONIT   (0x0u)

#define GPMC_CONFIG1_0_WRAPBURST   (0x80000000u)
#define GPMC_CONFIG1_0_WRAPBURST_SHIFT   (0x0000001Fu)
#define GPMC_CONFIG1_0_WRAPBURST_WRAPNOTSUPP   (0x0u)
#define GPMC_CONFIG1_0_WRAPBURST_WRAPSUPP   (0x1u)

#define GPMC_CONFIG1_0_WRITEMULTIPLE   (0x10000000u)
#define GPMC_CONFIG1_0_WRITEMULTIPLE_SHIFT   (0x0000001Cu)
#define GPMC_CONFIG1_0_WRITEMULTIPLE_WRMULTIPLE   (0x1u)
#define GPMC_CONFIG1_0_WRITEMULTIPLE_WRSINGLE   (0x0u)

#define GPMC_CONFIG1_0_WRITETYPE   (0x08000000u)
#define GPMC_CONFIG1_0_WRITETYPE_SHIFT   (0x0000001Bu)
#define GPMC_CONFIG1_0_WRITETYPE_WRASYNC   (0x0u)
#define GPMC_CONFIG1_0_WRITETYPE_WRSYNC   (0x1u)


/* CONFIG2_0 */
#define GPMC_CONFIG2_0_CSEXTRADELAY   (0x00000080u)
#define GPMC_CONFIG2_0_CSEXTRADELAY_SHIFT   (0x00000007u)
#define GPMC_CONFIG2_0_CSEXTRADELAY_DELAYED   (0x1u)
#define GPMC_CONFIG2_0_CSEXTRADELAY_NOTDELAYED   (0x0u)

#define GPMC_CONFIG2_0_CSONTIME   (0x0000000Fu)
#define GPMC_CONFIG2_0_CSONTIME_SHIFT   (0x00000000u)

#define GPMC_CONFIG2_0_CSRDOFFTIME   (0x00001F00u)
#define GPMC_CONFIG2_0_CSRDOFFTIME_SHIFT   (0x00000008u)

#define GPMC_CONFIG2_0_CSWROFFTIME   (0x001F0000u)
#define GPMC_CONFIG2_0_CSWROFFTIME_SHIFT   (0x00000010u)


/* CONFIG3_0 */
#define GPMC_CONFIG3_0_ADVAADMUXONTIME   (0x00000070u)
#define GPMC_CONFIG3_0_ADVAADMUXONTIME_SHIFT   (0x00000004u)

#define GPMC_CONFIG3_0_ADVAADMUXRDOFFTIME   (0x07000000u)
#define GPMC_CONFIG3_0_ADVAADMUXRDOFFTIME_SHIFT   (0x00000018u)

#define GPMC_CONFIG3_0_ADVAADMUXWROFFTIME   (0x70000000u)
#define GPMC_CONFIG3_0_ADVAADMUXWROFFTIME_SHIFT   (0x0000001Cu)

#define GPMC_CONFIG3_0_ADVEXTRADELAY   (0x00000080u)
#define GPMC_CONFIG3_0_ADVEXTRADELAY_SHIFT   (0x00000007u)
#define GPMC_CONFIG3_0_ADVEXTRADELAY_DELAYED   (0x1u)
#define GPMC_CONFIG3_0_ADVEXTRADELAY_NOTDELAYED   (0x0u)

#define GPMC_CONFIG3_0_ADVONTIME   (0x0000000Fu)
#define GPMC_CONFIG3_0_ADVONTIME_SHIFT   (0x00000000u)

#define GPMC_CONFIG3_0_ADVRDOFFTIME   (0x00001F00u)
#define GPMC_CONFIG3_0_ADVRDOFFTIME_SHIFT   (0x00000008u)

#define GPMC_CONFIG3_0_ADVWROFFTIME   (0x001F0000u)
#define GPMC_CONFIG3_0_ADVWROFFTIME_SHIFT   (0x00000010u)


/* CONFIG4_0 */
#define GPMC_CONFIG4_0_OEAADMUXOFFTIME   (0x0000E000u)
#define GPMC_CONFIG4_0_OEAADMUXOFFTIME_SHIFT   (0x0000000Du)

#define GPMC_CONFIG4_0_OEAADMUXONTIME   (0x00000070u)
#define GPMC_CONFIG4_0_OEAADMUXONTIME_SHIFT   (0x00000004u)

#define GPMC_CONFIG4_0_OEEXTRADELAY   (0x00000080u)
#define GPMC_CONFIG4_0_OEEXTRADELAY_SHIFT   (0x00000007u)
#define GPMC_CONFIG4_0_OEEXTRADELAY_DELAYED   (0x1u)
#define GPMC_CONFIG4_0_OEEXTRADELAY_NOTDELAYED   (0x0u)

#define GPMC_CONFIG4_0_OEOFFTIME   (0x00001F00u)
#define GPMC_CONFIG4_0_OEOFFTIME_SHIFT   (0x00000008u)

#define GPMC_CONFIG4_0_OEONTIME   (0x0000000Fu)
#define GPMC_CONFIG4_0_OEONTIME_SHIFT   (0x00000000u)

#define GPMC_CONFIG4_0_WEEXTRADELAY   (0x00800000u)
#define GPMC_CONFIG4_0_WEEXTRADELAY_SHIFT   (0x00000017u)
#define GPMC_CONFIG4_0_WEEXTRADELAY_DELAYED   (0x1u)
#define GPMC_CONFIG4_0_WEEXTRADELAY_NOTDELAYED   (0x0u)

#define GPMC_CONFIG4_0_WEOFFTIME   (0x1F000000u)
#define GPMC_CONFIG4_0_WEOFFTIME_SHIFT   (0x00000018u)

#define GPMC_CONFIG4_0_WEONTIME   (0x000F0000u)
#define GPMC_CONFIG4_0_WEONTIME_SHIFT   (0x00000010u)


/* CONFIG5_0 */
#define GPMC_CONFIG5_0_PAGEBURSTACCESSTIME   (0x0F000000u)
#define GPMC_CONFIG5_0_PAGEBURSTACCESSTIME_SHIFT   (0x00000018u)

#define GPMC_CONFIG5_0_RDACCESSTIME   (0x001F0000u)
#define GPMC_CONFIG5_0_RDACCESSTIME_SHIFT   (0x00000010u)

#define GPMC_CONFIG5_0_RDCYCLETIME   (0x0000001Fu)
#define GPMC_CONFIG5_0_RDCYCLETIME_SHIFT   (0x00000000u)

#define GPMC_CONFIG5_0_WRCYCLETIME   (0x00001F00u)
#define GPMC_CONFIG5_0_WRCYCLETIME_SHIFT   (0x00000008u)


/* CONFIG6_0 */
#define GPMC_CONFIG6_0_BUSTURNAROUND   (0x0000000Fu)
#define GPMC_CONFIG6_0_BUSTURNAROUND_SHIFT   (0x00000000u)

#define GPMC_CONFIG6_0_CYCLE2CYCLEDELAY   (0x00000F00u)
#define GPMC_CONFIG6_0_CYCLE2CYCLEDELAY_SHIFT   (0x00000008u)

#define GPMC_CONFIG6_0_CYCLE2CYCLEDIFFCSEN   (0x00000040u)
#define GPMC_CONFIG6_0_CYCLE2CYCLEDIFFCSEN_SHIFT   (0x00000006u)
#define GPMC_CONFIG6_0_CYCLE2CYCLEDIFFCSEN_C2CDELAY   (0x1u)
#define GPMC_CONFIG6_0_CYCLE2CYCLEDIFFCSEN_NOC2CDELAY   (0x0u)

#define GPMC_CONFIG6_0_CYCLE2CYCLESAMECSEN   (0x00000080u)
#define GPMC_CONFIG6_0_CYCLE2CYCLESAMECSEN_SHIFT   (0x00000007u)
#define GPMC_CONFIG6_0_CYCLE2CYCLESAMECSEN_C2CDELAY   (0x1u)
#define GPMC_CONFIG6_0_CYCLE2CYCLESAMECSEN_NOC2CDELAY   (0x0u)

#define GPMC_CONFIG6_0_WRACCESSTIME   (0x1F000000u)
#define GPMC_CONFIG6_0_WRACCESSTIME_SHIFT   (0x00000018u)

#define GPMC_CONFIG6_0_WRDATAONADMUXBUS   (0x000F0000u)
#define GPMC_CONFIG6_0_WRDATAONADMUXBUS_SHIFT   (0x00000010u)


/* CONFIG7_0 */
#define GPMC_CONFIG7_0_BASEADDRESS   (0x00000008u) //0x3f
#define GPMC_CONFIG7_0_BASEADDRESS_SHIFT   (0x00000000u)

#define GPMC_CONFIG7_0_CSVALID   (0x00000040u)
#define GPMC_CONFIG7_0_CSVALID_SHIFT   (0x00000006u)
#define GPMC_CONFIG7_0_CSVALID_CSDISABLED   (0x0u)
#define GPMC_CONFIG7_0_CSVALID_CSENABLED   (0x1u)

#define GPMC_CONFIG7_0_MASKADDRESS   (0x00000008u) //32MB 0xf00
#define GPMC_CONFIG7_0_MASKADDRESS_SHIFT   (0x00000008u)




#define CTRL_WEN 0x898
#define CTRL_ADVN 0x890
#define CTRL_OEN 0x894
#define CTRL_CS0 0x87C

#define CTRL_AD_OFFSET 0x4
#define CTRL_CS_OFFSET 0x4
#define GPMC_OFFSET(base, n, offset) (base + n * offset) / 4
#define MODE0 0x0 
#define MODE1 0x1 
#define MODE2 0x2 
#define MODE3 0x3 
#define MODE4 0x4 
#define MODE5 0x5 
#define MODE6 0x6 
#define MODE7 0x7 
#define RX_ACTIVE (0x1<<5)


struct gpmcdev_platform_data
{
    int block_size;
    int perm;
    const char *serial_number;
    int gpmc_base[2];
    int gpmc_sys_config;
    int gpmc_conf1[2];
    int gpmc_conf2[2];
    int gpmc_conf3[2];
    int gpmc_conf4[2];
    int gpmc_conf5[2];
    int gpmc_conf6[2];
    int gpmc_conf7[2];
    int ctrl_base;
    int ctrl_base_ad0;
    int ctrl_base_cs0;
    int ctrl_base_wen;
    int ctrl_base_advn;
    int ctrl_base_oen;
    int gpmc_cs_num;
    int gpmc_cs[7];
};

struct gpmc_cs_data 
{
	const char *name;

#define GPMC_CS_RESERVED	(1 << 0)
	u32 flags;

	struct resource mem;
} ;

#define RDWR   0x11
#define RDONLY 0X01
#define WRONLY 0X10

void gpmc_cs_write_reg(int cs, int idx, u32 val);
#endif